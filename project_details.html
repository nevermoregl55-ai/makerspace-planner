<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Details</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #f1f5f9; }
        .main-image { width: 100%; height: 400px; object-fit: cover; }
        .thumbnail { width: 100px; height: 100px; object-fit: cover; cursor: pointer; border: 2px solid transparent; }
        .thumbnail.active { border-color: #2563eb; }
    </style>
</head>
<body class="text-slate-800">
    <div id="app" class="container mx-auto max-w-5xl p-4 sm:p-6 md:p-8">
        <div id="loading" class="text-center p-10">
            <p class="text-xl font-semibold">Loading project details...</p>
        </div>
        <div id="project-content" class="hidden bg-white p-8 rounded-xl shadow-lg">
           <a href="gallery.html" class="text-blue-600 hover:underline mb-6 inline-block">&larr; Back to Gallery</a>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <!-- Image Section -->
                <div>
                    <img id="main-image" src="https://placehold.co/800x600/e2e8f0/475569?text=Loading..." alt="Main project image" class="rounded-lg mb-4 main-image">
                    <div id="thumbnail-container" class="flex gap-4 flex-wrap">
                        <!-- Thumbnails will be loaded here -->
                    </div>
                </div>

                <!-- Details Section -->
                <div class="space-y-4">
                    <h1 id="project-name" class="text-4xl font-bold text-slate-900"></h1>
                    <p id="project-description" class="text-slate-600"></p>
                    
                    <div class="border-t pt-4">
                        <h3 class="text-lg font-semibold">Details</h3>
                        <p><strong>Machine Type:</strong> <span id="project-type"></span></p>
                        <p><strong>Total Time:</strong> <span id="project-time"></span> minutes</p>
                    </div>

                    <div id="settings-container" class="border-t pt-4">
                       <!-- Machine specific settings will be injected here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            /* PASTE YOUR FIREBASE CONFIG OBJECT HERE */
        };

        async function initialize() {
             try {
                const app = initializeApp(firebaseConfig);
                const db = getFirestore(app);
                
                const urlParams = new URLSearchParams(window.location.search);
                const projectId = urlParams.get('id');

                if (projectId) {
                    loadProjectDetails(db, projectId);
                } else {
                    document.getElementById('loading').textContent = 'Error: No project ID provided.';
                }
            } catch (error) {
                 console.error("Firebase Initialization Error:", error);
                document.getElementById('loading').textContent = 'Error: Could not connect to the database.';
            }
        }

        async function loadProjectDetails(db, projectId) {
            const loadingEl = document.getElementById('loading');
            const contentEl = document.getElementById('project-content');
            try {
                const docRef = doc(db, "projects", projectId);
                const docSnap = await getDoc(docRef);

                if (docSnap.exists()) {
                    const project = docSnap.data();
                    displayProjectDetails(project);
                    loadingEl.style.display = 'none';
                    contentEl.classList.remove('hidden');
                } else {
                    loadingEl.textContent = "Project not found.";
                }
            } catch (error) {
                console.error("Error getting document:", error);
                loadingEl.textContent = "Error loading project data.";
            }
        }

        function displayProjectDetails(project) {
            document.title = project.name;
            document.getElementById('project-name').textContent = project.name;
            document.getElementById('project-description').textContent = project.description;
            document.getElementById('project-type').textContent = project.type.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase());
            document.getElementById('project-time').textContent = project.totalTimeMinutes || project.buildTimeMinutes;
            
            // Image Gallery
            const mainImage = document.getElementById('main-image');
            const thumbnailContainer = document.getElementById('thumbnail-container');
            mainImage.src = project.images[0] || 'https://placehold.co/800x600/e2e8f0/475569?text=No+Image';
            thumbnailContainer.innerHTML = '';
            project.images.forEach((imgSrc, index) => {
                const thumb = document.createElement('img');
                thumb.src = imgSrc;
                thumb.className = 'thumbnail';
                if (index === 0) thumb.classList.add('active');
                thumb.onclick = () => {
                    mainImage.src = imgSrc;
                    document.querySelectorAll('.thumbnail').forEach(t => t.classList.remove('active'));
                    thumb.classList.add('active');
                };
                thumbnailContainer.appendChild(thumb);
            });

            // Machine Settings
            const settingsContainer = document.getElementById('settings-container');
            let settingsHTML = '<h3 class="text-lg font-semibold">Machine Settings</h3>';
            if (project.type === '3d-printer') {
                 settingsHTML += `<p><strong>Printer:</strong> ${project.settings.printer}</p>
                                <p><strong>Material:</strong> ${project.settings.material}</p>
                                <p><strong>Layer Height:</strong> ${project.settings.layerHeight_mm} mm</p>
                                <p><strong>Infill:</strong> ${project.settings.infill_percent}%</p>`;
            } else if (project.type === 'laser-cutter') {
                settingsHTML += project.settings.map(s => `
                    <div class="border-t mt-2 pt-2">
                        <p><strong>Operation:</strong> ${s.type}</p>
                        <p><strong>Power:</strong> ${s.power}% | <strong>Speed:</strong> ${s.speed}% | <strong>DPI:</strong> ${s.dpi}</p>
                    </div>`).join('');
            }
            // Add other project types here later
            settingsContainer.innerHTML = settingsHTML;
        }
        
        initialize();
    </script>
</body>
</html>
