<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Area 59 - Project Details</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .main-image { max-height: 60vh; }
        .thumbnail {
            height: 100px;
            width: 100px;
            object-fit: cover;
            cursor: pointer;
            border: 2px solid transparent;
            transition: border-color 0.2s;
        }
        .thumbnail.active { border-color: #2563eb; }
    </style>
</head>
<body class="bg-slate-100">
    <div id="project-container" class="container mx-auto max-w-5xl p-4 sm:p-6 md:p-8">
        <p class="text-center">Loading project details...</p>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyA30A5Qh43IVxy0ZJnVTW9rtvYZG7Cp8-s",
            authDomain: "area-59-makerspace.firebaseapp.com",
            projectId: "area-59-makerspace",
            storageBucket: "area-59-makerspace.appspot.com",
            messagingSenderId: "721728366959",
            appId: "1:721728366959:web:8a6513baa852e5699b609a",
            measurementId: "G-8RFF3XJWFL"
        };
        
        async function loadProjectDetails() {
            const container = document.getElementById('project-container');
            const params = new URLSearchParams(window.location.search);
            const projectId = params.get('id');

            if (!projectId) {
                container.innerHTML = '<p class="text-center text-red-500">No project ID provided.</p>';
                return;
            }

            try {
                const app = initializeApp(firebaseConfig);
                const db = getFirestore(app);
                const docRef = doc(db, "projects", projectId);
                const docSnap = await getDoc(docRef);

                if (!docSnap.exists()) {
                    container.innerHTML = '<p class="text-center text-red-500">Project not found.</p>';
                    return;
                }

                const project = docSnap.data();
                renderProject(project);

            } catch (error) {
                console.error("Error loading project: ", error);
                container.innerHTML = '<p class="text-center text-red-500">Could not load project details.</p>';
            }
        }
        
        function renderProject(p) {
            const container = document.getElementById('project-container');
            
            let settingsHTML = '';
            if (p.type === 'laser') {
                settingsHTML = p.laserOperations.map(op => `
                    <div class="p-3 bg-slate-200 rounded-md">
                        <p class="font-semibold">${op.type}</p>
                        <p>Power: ${op.power}% | Speed: ${op.speed}% | DPI: ${op.dpi}</p>
                    </div>`).join('');
            } else if (p.type === '3d-printer') {
                settingsHTML = `
                    <p><span class="font-semibold">Printer:</span> ${p.settings.printer}</p>
                    <p><span class="font-semibold">Material:</span> ${p.settings.material}</p>
                    <p><span class="font-semibold">Layer Height:</span> ${p.settings.layerHeight_mm} mm</p>
                    <p><span class="font-semibold">Infill:</span> ${p.settings.infill_percent}%</p>
                `;
            } // Add more types as needed

            container.innerHTML = `
                <div class="bg-white rounded-lg shadow-xl overflow-hidden">
                    <div class="p-4 text-center">
                        <a href="gallery.html" class="text-blue-600 hover:underline">&larr; Back to Gallery</a>
                    </div>
                    <div class="w-full bg-black flex justify-center">
                        <img id="main-image" src="${p.imageUrls?.[0] || ''}" alt="${p.name}" class="main-image object-contain">
                    </div>
                    <div id="thumbnail-container" class="flex justify-center gap-2 p-4 bg-slate-200">
                        ${(p.imageUrls || []).map((url, index) => `
                            <img src="${url}" class="thumbnail ${index === 0 ? 'active' : ''}" data-index="${index}">
                        `).join('')}
                    </div>
                    <div class="p-6 md:p-8">
                        <h1 class="text-3xl md:text-4xl font-bold mb-2">${p.name}</h1>
                        <p class="text-slate-600 mb-6">${p.description}</p>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <div>
                                <h2 class="text-2xl font-semibold border-b pb-2 mb-3">Details</h2>
                                <div class="space-y-2">
                                    <p><span class="font-semibold">Machine Type:</span> ${p.type}</p>
                                    <p><span class="font-semibold">Machine Run Time:</span> ${p.buildTimeMinutes} minutes</p>
                                    <p><span class="font-semibold">Assembly Time:</span> ${p.postProcessing.assemblyTimeMinutes || '0'} minutes</p>
                                </div>
                            </div>
                             <div>
                                <h2 class="text-2xl font-semibold border-b pb-2 mb-3">Machine Settings</h2>
                                <div class="space-y-2">
                                    ${settingsHTML}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;

             // Add event listeners for thumbnails
            document.querySelectorAll('.thumbnail').forEach(thumb => {
                thumb.addEventListener('click', (e) => {
                    const mainImage = document.getElementById('main-image');
                    mainImage.src = e.target.src;
                    document.querySelectorAll('.thumbnail').forEach(t => t.classList.remove('active'));
                    e.target.classList.add('active');
                });
            });
        }

        loadProjectDetails();
    </script>
</body>
</html>

