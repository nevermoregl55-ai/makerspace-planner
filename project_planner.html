<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Area 59 - AI Project Planner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border-left-color: #fff;
            animation: spin 1s ease infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Tab Styles */
        .tab-button {
            transition: all 0.2s ease-in-out;
        }
        .tab-button.active {
            border-color: #3b82f6;
            color: #3b82f6;
            background-color: #eff6ff;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* Checklist Styles */
        .task-checkbox:checked + .task-label {
            text-decoration: line-through;
            color: #6b7280;
        }
        /* Skill level badge styles */
        .skill-badge {
            display: inline-block;
            padding: 0.25em 0.6em;
            font-size: .75em;
            font-weight: 700;
            line-height: 1;
            text-align: center;
            white-space: nowrap;
            vertical-align: baseline;
            border-radius: .375rem;
        }
        .skill-beginner { background-color: #dbeafe; color: #1e40af; }
        .skill-intermediate { background-color: #fef3c7; color: #92400e; }
        .skill-advanced { background-color: #fee2e2; color: #991b1b; }
        .modal-backdrop {
            background-color: rgba(0,0,0,0.5);
            transition: opacity 0.3s ease-in-out;
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800">

    <!-- API Key Modal -->
    <div id="api-key-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 hidden">
        <div id="modal-backdrop" class="modal-backdrop fixed inset-0"></div>
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md z-10 transform transition-all" id="modal-content">
            <div class="p-6">
                <div class="flex justify-between items-center pb-3 border-b">
                    <h3 class="text-xl font-semibold text-slate-900">API Key Required</h3>
                    <button id="close-modal-btn" class="text-slate-400 hover:text-slate-600">&times;</button>
                </div>
                <div class="mt-4">
                    <p class="text-sm text-slate-600 mb-3">To use the AI features, you need a free Google AI API key. This key will be saved securely in your browser's local storage and will not be shared.</p>
                    <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-sm text-blue-600 hover:underline font-medium">Click here to get your API key from Google AI Studio &rarr;</a>
                    <div class="mt-4">
                        <label for="api-key-input" class="block text-sm font-medium text-slate-700">Your Google AI API Key</label>
                        <input type="password" id="api-key-input" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md text-sm shadow-sm placeholder-slate-400 focus:outline-none focus:border-sky-500 focus:ring-1 focus:ring-sky-500">
                    </div>
                </div>
                <div class="mt-6 flex justify-end gap-3">
                    <button id="save-api-key-btn" class="bg-blue-600 text-white font-semibold px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors shadow-sm">Save Key</button>
                </div>
            </div>
        </div>
    </div>

    <div class="container mx-auto max-w-5xl p-4 sm:p-6 md:p-8">
        <!-- Header -->
        <header class="text-center mb-8 relative">
            <h1 class="text-4xl font-bold text-slate-900">Area 59 AI Project Planner</h1>
            <p class="text-slate-600 mt-2 max-w-3xl mx-auto">Have a project idea, a sketch, or an inspiration photo? Upload an image, add a description, or both! Our AI assistant will instantly generate a detailed project plan to help you get started at the makerspace.</p>
            <button id="settings-btn" class="absolute top-0 right-0 p-2 text-slate-500 hover:text-slate-800 transition-colors" title="Settings">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>
            </button>
        </header>

        <main class="space-y-6">
            <div id="api-key-warning" class="hidden bg-red-100 border-l-4 border-red-500 text-red-700 p-4 rounded-md" role="alert">
                <p class="font-bold">Missing API Key</p>
                <p>Please <a href="#" id="open-modal-link" class="font-bold underline">set your Google AI API key</a> to enable the project planner.</p>
            </div>

            <!-- AI Input Section -->
            <section class="bg-white p-6 rounded-xl shadow-md">
                <h2 class="text-2xl font-semibold mb-4 border-b pb-2 flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-blue-600"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"></path><path d="M5 3v4"></path><path d="M19 17v4"></path><path d="M3 5h4"></path><path d="M17 19h4"></path></svg>
                    Start Your Plan
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-start">
                    <div>
                        <label for="user-description" class="block text-sm font-medium text-slate-700 mb-1">Describe your project (optional)</label>
                        <textarea id="user-description" rows="4" placeholder="e.g., 'I want to build a small, rustic-looking bookshelf for my living room, similar to the picture.'" class="w-full p-2 border border-slate-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">Upload a reference image (optional)</label>
                        <div class="flex items-center gap-3">
                            <input type="file" id="image-upload-input" accept="image/*" class="hidden">
                            <label for="image-upload-input" class="cursor-pointer bg-slate-200 text-slate-800 px-4 py-2 rounded-lg hover:bg-slate-300 transition-colors font-medium">Choose Image...</label>
                            <span id="file-name" class="text-sm text-slate-500 italic">No file chosen</span>
                        </div>
                        <div id="image-preview-container" class="hidden mt-4 h-32 w-full bg-slate-50 rounded-lg border-2 border-dashed flex items-center justify-center">
                            <img id="image-preview" src="#" alt="Image preview" class="max-h-full max-w-full rounded-md object-contain"/>
                        </div>
                    </div>
                </div>
                <div class="mt-6">
                     <button id="analyze-btn" class="w-full bg-blue-600 text-white px-4 py-2.5 rounded-lg hover:bg-blue-700 transition-colors shadow-sm font-semibold disabled:bg-slate-400 disabled:cursor-not-allowed flex items-center justify-center gap-3" disabled>
                        Generate In-Depth Plan
                        <div id="spinner-container" class="hidden"><div class="spinner"></div></div>
                    </button>
                </div>
                 <div id="ai-status" class="mt-4 text-center font-medium"></div>
            </section>

            <!-- AI-Generated Project Plan Section -->
            <section id="plan-section" class="bg-white p-6 rounded-xl shadow-md hidden">
                <div id="plan-placeholder" class="text-center text-slate-500 py-12">
                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="mx-auto mb-4 text-slate-400"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><line x1="10" y1="9" x2="8" y2="9"></line></svg>
                    Your generated project plan will appear here.
                </div>
                
                <div id="plan-content" class="hidden">
                    <h2 id="ai-project-name" class="text-3xl font-bold text-slate-900 mb-4 border-b pb-3"></h2>
                    
                    <!-- Tabs -->
                    <div class="border-b border-gray-200 mb-4">
                        <nav class="-mb-px flex space-x-6" aria-label="Tabs">
                            <button class="tab-button active whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm" data-tab="overview">Overview</button>
                            <button class="tab-button whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="materials">Materials & Tools</button>
                            <button class="tab-button whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="steps">Step-by-Step Plan</button>
                            <button class="tab-button whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="safety">Safety</button>
                        </nav>
                    </div>

                    <!-- Tab Content -->
                    <div id="tab-content-container">
                        <div id="overview-content" class="tab-content active space-y-6">
                            <div>
                                <h3 class="text-xl font-semibold mb-2">Project Summary</h3>
                                <p id="ai-project-summary" class="text-slate-600"></p>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="bg-slate-50 p-4 rounded-lg border">
                                    <h4 class="font-semibold text-lg mb-2">Overall Skill Level</h4>
                                    <p id="ai-skill-level" class="text-blue-600 font-bold text-xl"></p>
                                </div>
                                <div class="bg-slate-50 p-4 rounded-lg border">
                                    <h4 class="font-semibold text-lg mb-3">Skills Required</h4>
                                    <div id="ai-skills-breakdown" class="space-y-2"></div>
                                </div>
                            </div>
                            
                            <div class="bg-slate-50 p-4 rounded-lg border">
                                <h4 class="font-semibold text-lg mb-2">Design Considerations</h4>
                                <ul id="ai-design-considerations" class="list-disc list-inside text-slate-600 space-y-1"></ul>
                            </div>
                        </div>

                        <div id="materials-content" class="tab-content">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <h3 class="text-xl font-semibold mb-3">Materials Needed</h3>
                                    <ul id="ai-materials-list" class="space-y-2"></ul>
                                </div>
                                <div>
                                    <h3 class="text-xl font-semibold mb-3">Equipment Required</h3>
                                    <ul id="ai-equipment-list" class="space-y-2"></ul>
                                </div>
                            </div>
                        </div>
                        
                        <div id="steps-content" class="tab-content">
                            <h3 class="text-xl font-semibold mb-3">Project Phases</h3>
                            <div id="ai-steps-phases" class="space-y-6"></div>
                        </div>
                        
                        <div id="safety-content" class="tab-content">
                             <div class="bg-amber-50 border-l-4 border-amber-400 p-4 rounded-r-lg">
                                <div class="flex">
                                    <div class="flex-shrink-0">
                                        <svg class="h-5 w-5 text-amber-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                            <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.21 3.03-1.742 3.03H4.42c-1.532 0-2.492-1.696-1.742-3.03l5.58-9.92zM10 13a1 1 0 110-2 1 1 0 010 2zm-1-8a1 1 0 011-1h.01a1 1 0 110 2H10a1 1 0 01-1-1z" clip-rule="evenodd" />
                                        </svg>
                                    </div>
                                    <div class="ml-3">
                                        <h3 class="text-lg font-medium text-amber-800">Important Safety Warning</h3>
                                        <div class="mt-2 text-sm text-amber-700">
                                            <p id="ai-safety-warning"></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
        <footer class="text-center mt-8 text-sm text-slate-500">
            <p>Area 59 Makerspace Planner</p>
            <a href="admin.html" class="hover:text-blue-600 underline">Admin Login</a>
        </footer>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', async () => {
        let makerspaceTools = {};
        let inventoryLoaded = false;
        let apiKey = '';

        // --- API Key Management ---
        const apiKeyModal = document.getElementById('api-key-modal');
        const closeModalBtn = document.getElementById('close-modal-btn');
        const settingsBtn = document.getElementById('settings-btn');
        const saveApiKeyBtn = document.getElementById('save-api-key-btn');
        const apiKeyInput = document.getElementById('api-key-input');
        const apiKeyWarning = document.getElementById('api-key-warning');
        const openModalLink = document.getElementById('open-modal-link');
        const modalBackdrop = document.getElementById('modal-backdrop');

        function openModal() { apiKeyModal.classList.remove('hidden'); }
        function closeModal() { apiKeyModal.classList.add('hidden'); }

        settingsBtn.addEventListener('click', openModal);
        openModalLink.addEventListener('click', (e) => { e.preventDefault(); openModal(); });
        closeModalBtn.addEventListener('click', closeModal);
        modalBackdrop.addEventListener('click', closeModal);

        saveApiKeyBtn.addEventListener('click', () => {
            const key = apiKeyInput.value.trim();
            if (key) {
                localStorage.setItem('googleAiApiKey', key);
                apiKey = key;
                apiKeyWarning.classList.add('hidden');
                alert('API Key saved successfully!');
                closeModal();
            } else {
                alert('Please enter a valid API key.');
            }
        });

        function loadApiKey() {
            const savedKey = localStorage.getItem('googleAiApiKey');
            if (savedKey) {
                apiKey = savedKey;
                apiKeyInput.value = savedKey;
            } else {
                apiKeyWarning.classList.remove('hidden');
            }
        }

        async function loadInventory() {
            try {
                const response = await fetch(`inventory.json?v=${new Date().getTime()}`);
                if (!response.ok) throw new Error('Network response was not ok');
                makerspaceTools = await response.json();
                inventoryLoaded = true;
            } catch (error) {
                console.error("Fatal Error: Could not load inventory.json.", error);
                document.body.innerHTML = `<div class="p-8 text-center bg-slate-100"><div class="bg-white p-6 rounded-lg shadow-md max-w-2xl mx-auto"><h1 class="text-2xl font-bold text-red-600">Error: Could Not Load Inventory</h1><p class="text-slate-600 mt-2">The makerspace tool inventory file ('inventory.json') could not be found. Please contact an admin to have this file created using the admin panel.</p></div></div>`;
            }
        }
        
        loadApiKey(); // Load key first
        await loadInventory(); // Then load inventory

        if (!inventoryLoaded) {
            return; // Stop script execution if inventory failed to load
        }

        // --- Element Selectors ---
        const userDescriptionInput = document.getElementById('user-description');
        const imageUploadInput = document.getElementById('image-upload-input');
        const analyzeBtn = document.getElementById('analyze-btn');
        const fileNameSpan = document.getElementById('file-name');
        const imagePreviewContainer = document.getElementById('image-preview-container');
        const imagePreview = document.getElementById('image-preview');
        const aiStatus = document.getElementById('ai-status');
        const spinnerContainer = document.getElementById('spinner-container');
        
        const planSection = document.getElementById('plan-section');
        const planPlaceholder = document.getElementById('plan-placeholder');
        const planContent = document.getElementById('plan-content');
        
        let uploadedImageBase64 = null;

        // --- Input Handling ---
        function checkInputs() {
            const hasText = userDescriptionInput.value.trim().length > 0;
            const hasImage = !!uploadedImageBase64;
            analyzeBtn.disabled = !hasText && !hasImage;
        }

        userDescriptionInput.addEventListener('input', checkInputs);
        imageUploadInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                fileNameSpan.textContent = file.name;
                imagePreviewContainer.classList.remove('hidden');
                const reader = new FileReader();
                reader.onload = (e) => {
                    imagePreview.src = e.target.result;
                    uploadedImageBase64 = e.target.result.split(',')[1];
                    checkInputs();
                };
                reader.readAsDataURL(file);
            }
        });

        // --- AI Feature Logic ---
        analyzeBtn.addEventListener('click', async () => {
            if (!apiKey) {
                showStatus('API Key is missing. Please set it in the settings.', 'error');
                openModal();
                return;
            }

            const userText = userDescriptionInput.value.trim();
            if (!uploadedImageBase64 && !userText) {
                showStatus('Please upload an image or describe your project.', 'error');
                return;
            }
            
            showStatus('Generating in-depth plan... This may take a moment.', 'loading');
            spinnerContainer.classList.remove('hidden');
            analyzeBtn.disabled = true;
            planSection.classList.remove('hidden');
            planContent.classList.add('hidden');
            planPlaceholder.classList.remove('hidden');
            planPlaceholder.textContent = 'AI is analyzing your input and building a plan...';

            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

            const systemPrompt = `You are an expert project planner for a community makerspace. Your task is to analyze user input (text and/or image) and generate a comprehensive, structured project plan. Be realistic, encouraging, and prioritize safety. Your response MUST be in the specified JSON format.
            - When generating the skill breakdown, identify the specific disciplines involved (e.g., 'Woodworking', '3D Modeling', 'Circuit Design') and assign a realistic proficiency level to each.
            - Reference the provided list of available tools when suggesting equipment.

            Available Makerspace Tools: ${JSON.stringify(makerspaceTools)}`;
            
            const userParts = [];
            let userPrompt = "Analyze the following project idea and generate a detailed, in-depth plan suitable for a makerspace environment.";
            if (userText) {
                userPrompt += `\n\nUser's Description: "${userText}"`;
            }
            userParts.push({ text: userPrompt });

            if(uploadedImageBase64) {
                 userParts.push({ inlineData: { mimeType: "image/jpeg", data: uploadedImageBase64 } });
            }

            const payload = {
                systemInstruction: { parts: [{ text: systemPrompt }] },
                contents: [{ role: "user", parts: userParts }],
                generationConfig: {
                    responseMimeType: "application/json",
                    responseSchema: {
                        type: "OBJECT",
                        properties: {
                            "projectName": { "type": "STRING", "description": "A concise, descriptive name for the project." },
                            "projectSummary": { "type": "STRING", "description": "A brief, one-paragraph summary of the project." },
                            "estimatedSkillLevel": { "type": "STRING", "enum": ["Beginner", "Intermediate", "Advanced"], "description": "The overall estimated skill level required for the project."},
                            "estimatedSkills": { 
                                "type": "ARRAY", 
                                "description": "A detailed breakdown of the specific skills required for the project.",
                                "items": { 
                                    "type": "OBJECT", 
                                    "properties": {
                                        "skillName": { "type": "STRING", "description": "The name of the specific skill (e.g., 'Table Saw Operation', 'CAD Design')." },
                                        "skillLevel": { "type": "STRING", "enum": ["Beginner", "Intermediate", "Advanced"], "description": "The required proficiency for this specific skill." }
                                    }
                                } 
                            },
                            "designConsiderations": { "type": "ARRAY", "items": { "type": "STRING" }, "description": "A list of 3-4 key things the user should think about or decide before starting (e.g., dimensions, wood type, finish)." },
                            "safetyWarning": { "type": "STRING", "description": "A crucial, high-level safety warning related to the primary tools or materials involved (e.g., 'Always wear safety glasses when using the table saw.')." },
                            "materials": { "type": "ARRAY", "items": { "type": "OBJECT", "properties": { "name": { "type": "STRING" }, "details": { "type": "STRING", "description": "Specific details like dimensions, type, or quantity." } } }, "description": "List of required materials." },
                            "equipment": { "type": "ARRAY", "items": { "type": "OBJECT", "properties": { "name": { "type": "STRING" }, "usageNotes": { "type": "STRING", "description": "Brief note on why or how to use it (e.g., 'For cutting straight lines')." } } }, "description": "List of required equipment from the makerspace." },
                            "projectPhases": { "type": "ARRAY", "items": { "type": "OBJECT", "properties": { "phaseName": { "type": "STRING" }, "tasks": { "type": "ARRAY", "items": { "type": "STRING" } } } }, "description": "The project broken down into logical phases, each with a list of tasks." }
                        }
                    }
                }
            };
            
            try {
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                if (!response.ok) {
                    if (response.status === 403) throw new Error("API Error: Invalid API Key or permissions issue. Please check your key in the settings. (403)");
                    throw new Error(`API Error: ${response.statusText} (${response.status})`);
                }
                
                const result = await response.json();
                const jsonText = result.candidates?.[0]?.content?.parts?.[0]?.text;

                if (!jsonText) throw new Error('Could not find plan in AI response. Please try to be more descriptive or use a clearer image.');
                
                const plan = JSON.parse(jsonText);
                populatePlanner(plan);
                showStatus('In-depth plan generated successfully!', 'success');
                planPlaceholder.classList.add('hidden');
                planContent.classList.remove('hidden');

            } catch (error) {
                console.error("Error during AI analysis:", error);
                showStatus(`Analysis failed: ${error.message}`, 'error');
                planPlaceholder.textContent = `Error: ${error.message}. Please try again.`;
            } finally {
                spinnerContainer.classList.add('hidden');
                checkInputs();
            }
        });
        
        function showStatus(message, type) {
            aiStatus.textContent = message;
            if (type === 'success') aiStatus.className = 'mt-4 text-center font-medium text-green-600';
            else if (type === 'error') aiStatus.className = 'mt-4 text-center font-medium text-red-600';
            else aiStatus.className = 'mt-4 text-center font-medium text-slate-600';
        }

        function populatePlanner(plan) {
            // Overview Tab
            document.getElementById('ai-project-name').textContent = plan.projectName || 'Unnamed Project';
            document.getElementById('ai-project-summary').textContent = plan.projectSummary || 'No summary provided.';
            document.getElementById('ai-skill-level').textContent = plan.estimatedSkillLevel || 'Not specified.';
            
            const skillsContainer = document.getElementById('ai-skills-breakdown');
            skillsContainer.innerHTML = '';
            if (plan.estimatedSkills && plan.estimatedSkills.length > 0) {
                 plan.estimatedSkills.forEach(skill => {
                    const levelClass = `skill-${skill.skillLevel.toLowerCase()}`;
                    const skillElement = document.createElement('div');
                    skillElement.className = 'flex justify-between items-center';
                    skillElement.innerHTML = `
                        <span class="text-slate-700">${skill.skillName}</span>
                        <span class="skill-badge ${levelClass}">${skill.skillLevel}</span>
                    `;
                    skillsContainer.appendChild(skillElement);
                });
            } else {
                skillsContainer.innerHTML = '<p class="text-slate-500">No specific skills listed.</p>';
            }

            const designList = document.getElementById('ai-design-considerations');
            designList.innerHTML = '';
            plan.designConsiderations?.forEach(item => {
                const li = document.createElement('li');
                li.textContent = item;
                designList.appendChild(li);
            });

            // Materials & Tools Tab
            const materialsList = document.getElementById('ai-materials-list');
            materialsList.innerHTML = '';
            plan.materials?.forEach(item => {
                materialsList.innerHTML += `<li class="flex items-start p-2 bg-slate-50 rounded-md border"><span class="font-semibold w-2/5">${item.name}:</span><span class="text-slate-600 w-3/5">${item.details}</span></li>`;
            });
            const equipmentList = document.getElementById('ai-equipment-list');
            equipmentList.innerHTML = '';
            plan.equipment?.forEach(item => {
                 equipmentList.innerHTML += `<li class="flex items-start p-2 bg-slate-50 rounded-md border"><span class="font-semibold w-2/5">${item.name}:</span><span class="text-slate-600 w-3/5">${item.usageNotes}</span></li>`;
            });

            // Steps Tab
            const phasesContainer = document.getElementById('ai-steps-phases');
            phasesContainer.innerHTML = '';
            plan.projectPhases?.forEach((phase, index) => {
                let tasksHtml = '';
                phase.tasks.forEach((task, taskIndex) => {
                    const taskId = `phase-${index}-task-${taskIndex}`;
                    tasksHtml += `
                        <div class="relative flex items-start">
                            <div class="flex items-center h-5">
                                <input id="${taskId}" type="checkbox" class="task-checkbox h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                            </div>
                            <div class="ml-3 text-sm">
                                <label for="${taskId}" class="task-label font-medium text-gray-700">${task}</label>
                            </div>
                        </div>`;
                });

                phasesContainer.innerHTML += `
                    <div class="border border-slate-200 rounded-lg">
                        <div class="bg-slate-100 p-3 rounded-t-lg">
                            <h4 class="font-semibold text-lg">Phase ${index + 1}: ${phase.phaseName}</h4>
                        </div>
                        <div class="p-4 space-y-3">
                            ${tasksHtml}
                        </div>
                    </div>`;
            });

            // Safety Tab
            document.getElementById('ai-safety-warning').textContent = plan.safetyWarning || 'No specific safety warnings provided. Always follow standard makerspace safety rules.';
        }

        // --- Tab Switching Logic ---
        const tabButtons = document.querySelectorAll('.tab-button');
        const tabContents = document.querySelectorAll('.tab-content');
        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                const tab = button.dataset.tab;

                tabButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');

                tabContents.forEach(content => {
                    if (content.id === `${tab}-content`) {
                        content.classList.add('active');
                    } else {
                        content.classList.remove('active');
                    }
                });
            });
        });
    });
    </script>
</body>
</html>

