<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Area 59 - Class Calendar</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #f1f5f9; }
        .calendar-day { min-height: 120px; }
        .class-slot {
            font-size: 0.8rem;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            color: white;
            margin-top: 0.25rem;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
            background-color: #8b5cf6; /* purple-500 */
            cursor: pointer;
        }
        #class-modal { display: none; }
    </style>
</head>
<body class="text-slate-800">

    <!-- Class Details Modal -->
    <div id="class-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl shadow-lg p-8 w-full max-w-lg space-y-4 relative">
            <button id="close-modal-btn" class="absolute top-4 right-4 text-2xl font-bold text-slate-500 hover:text-slate-800">&times;</button>
            <h2 id="modal-title" class="text-2xl font-bold text-slate-900">Class Details</h2>
            <p id="modal-description" class="text-slate-600"></p>
            <div class="text-sm">
                <p><span class="font-semibold">Date:</span> <span id="modal-date"></span></p>
                <p><span class="font-semibold">Time:</span> <span id="modal-time"></span></p>
                <p><span class="font-semibold">Instructor:</span> <span id="modal-instructor"></span></p>
            </div>
        </div>
    </div>

    <div class="container mx-auto p-4 sm:p-6 md:p-8">
        <header class="text-center mb-8">
            <a href="index.html"><img src="Area_59_Logo_Color_3x1.png" alt="Area 59 Logo" class="mx-auto h-20 mb-4"></a>
            <h1 class="text-4xl font-bold text-slate-900">Class & Event Calendar</h1>
            <p class="text-slate-600 mt-2">See what's happening at Area 59. Click on an event for more details.</p>
        </header>

        <div class="flex items-center justify-center mb-6 gap-4">
            <button id="prev-month" class="px-4 py-2 bg-white rounded-lg shadow font-semibold">&larr;</button>
            <h2 id="month-year" class="text-2xl font-bold"></h2>
            <button id="next-month" class="px-4 py-2 bg-white rounded-lg shadow font-semibold">&rarr;</button>
        </div>

        <div id="calendar" class="grid grid-cols-7 gap-px bg-slate-200 border border-slate-200"></div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyA30A5Qh43IVxy0ZJnVTW9rtvYZG7Cp8-s",
            authDomain: "area-59-makerspace.firebaseapp.com",
            projectId: "area-59-makerspace",
            storageBucket: "area-59-makerspace.appspot.com",
            messagingSenderId: "721728366959",
            appId: "1:721728366959:web:8a6513baa852e5699b609a",
            measurementId: "G-8RFF3XJWFL"
        };

        let db, currentDate = new Date(), classes = [];

        async function initialize() {
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                await loadClasses();
                renderCalendar();
            } catch (error) {
                console.error("Firebase Init Error:", error);
                document.getElementById('calendar').innerHTML = '<p class="text-red-500 p-4 col-span-7">Could not connect to the calendar database.</p>';
            }
        }

        async function loadClasses() {
            classes = [];
            const querySnapshot = await getDocs(collection(db, "classes"));
            querySnapshot.forEach((doc) => classes.push({id: doc.id, ...doc.data()}));
        }

        function renderCalendar() {
            const calendarEl = document.getElementById('calendar');
            calendarEl.innerHTML = '';
            
            const month = currentDate.getMonth();
            const year = currentDate.getFullYear();
            
            document.getElementById('month-year').textContent = `${currentDate.toLocaleString('default', { month: 'long' })} ${year}`;

            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].forEach(day => {
                calendarEl.innerHTML += `<div class="text-center font-bold p-2 bg-slate-100">${day}</div>`;
            });

            for (let i = 0; i < firstDay; i++) calendarEl.appendChild(document.createElement('div'));

            for (let day = 1; day <= daysInMonth; day++) {
                const dayEl = document.createElement('div');
                dayEl.className = 'calendar-day p-2 bg-white relative';
                dayEl.innerHTML = `<span class="font-semibold">${day}</span>`;

                const todayStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                
                const dayClasses = classes.filter(c => c.date === todayStr);
                dayClasses.sort((a, b) => a.startTime.localeCompare(b.startTime));
                dayClasses.forEach(c => {
                    const classDiv = document.createElement('div');
                    classDiv.className = 'class-slot';
                    classDiv.textContent = c.title;
                    classDiv.title = c.title;
                    classDiv.dataset.classId = c.id;
                    dayEl.appendChild(classDiv);
                });

                calendarEl.appendChild(dayEl);
            }
        }

        // --- Modal & Calendar Navigation ---
        const modal = document.getElementById('class-modal');
        document.getElementById('close-modal-btn').addEventListener('click', () => modal.style.display = 'none');
        
        document.getElementById('calendar').addEventListener('click', (e) => {
            if (e.target.classList.contains('class-slot')) {
                const classId = e.target.dataset.classId;
                const classData = classes.find(c => c.id === classId);
                if (classData) {
                    document.getElementById('modal-title').textContent = classData.title;
                    document.getElementById('modal-description').textContent = classData.description;
                    document.getElementById('modal-date').textContent = new Date(classData.date + 'T00:00:00').toLocaleDateString(undefined, { weekday: 'long', month: 'long', day: 'numeric' });
                    document.getElementById('modal-time').textContent = `${classData.startTime} - ${classData.endTime}`;
                    document.getElementById('modal-instructor').textContent = classData.instructor;
                    modal.style.display = 'flex';
                }
            }
        });

        document.getElementById('prev-month').addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() - 1);
            renderCalendar();
        });

        document.getElementById('next-month').addEventListener('click', () => {
            currentDate.setMonth(currentDate.getMonth() + 1);
            renderCalendar();
        });

        initialize();
    </script>
</body>
</html>

